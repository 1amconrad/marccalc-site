<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarcCalc - Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f4; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: bold; }
        input { width: 100%; padding: 5px; box-sizing: border-box; }
        .total-cell { background-color: #e9e9e9; }
        button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; width: 100%; margin-bottom: 20px; }
        button:hover { background-color: #45a049; }
        #resultado-final { font-size: 18px; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>MarcCalc - Dashboard</h1>
    <button onclick="logout()">Sair</button>
    
    <!-- Calculadora de Orçamentos -->
    <h2>Orçamento de Custos</h2>
    <table id="tabela-orcamento">
        <thead>
            <tr>
                <th>Materiais</th>
                <th>Quantidade</th>
                <th>Valor Unitário</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            <!-- Linhas adicionadas via JS -->
        </tbody>
    </table>
    
    <button id="btn-valor-total">VALOR TOTAL</button>
    
    <label for="diaria">Preço da Diária:</label>
    <input type="number" id="diaria" placeholder="Ex: 100.00" step="0.01">
    
    <label for="margem">Margem de Lucro (%):</label>
    <input type="number" id="margem" placeholder="Ex: 20" step="0.01">
    
    <div id="resultado-final">Resultado Final: R$ 0.00</div>

    <script>
        // Verifica se o usuário está logado
        if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'index.html';
        }

        // Função de logout
        function logout() {
            localStorage.removeItem('isLoggedIn');
            window.location.href = 'index.html';
        }

        // Calculadora de Orçamentos
        const tabelaBody = document.querySelector('#tabela-orcamento tbody');
        const btnValorTotal = document.getElementById('btn-valor-total');
        const inputDiaria = document.getElementById('diaria');
        const inputMargem = document.getElementById('margem');
        const resultadoFinal = document.getElementById('resultado-final');

        function formatarMoeda(valor) {
            return `R$ ${valor.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.')}`;
        }

        function adicionarLinha() {
            const row = document.createElement('tr');
            const cellMateriais = document.createElement('td');
            const inputMateriais = document.createElement('input');
            inputMateriais.type = 'text';
            inputMateriais.placeholder = 'Material';
            cellMateriais.appendChild(inputMateriais);

            const cellQuantidade = document.createElement('td');
            const inputQuantidade = document.createElement('input');
            inputQuantidade.type = 'number';
            inputQuantidade.placeholder = 'Qty';
            inputQuantidade.step = '0.01';
            cellQuantidade.appendChild(inputQuantidade);

            const cellValorUnitario = document.createElement('td');
            const inputValorUnitario = document.createElement('input');
            inputValorUnitario.type = 'number';
            inputValorUnitario.placeholder = 'Unit.';
            inputValorUnitario.step = '0.01';
            cellValorUnitario.appendChild(inputValorUnitario);

            const cellTotal = document.createElement('td');
            cellTotal.classList.add('total-cell');
            cellTotal.textContent = 'R$ 0.00';

            const calcularTotalLinha = () => {
                const qty = parseFloat(inputQuantidade.value) || 0;
                const unit = parseFloat(inputValorUnitario.value) || 0;
                const total = qty * unit;
                cellTotal.textContent = formatarMoeda(total);
            };
            inputQuantidade.addEventListener('input', calcularTotalLinha);
            inputValorUnitario.addEventListener('input', calcularTotalLinha);

            row.appendChild(cellMateriais);
            row.appendChild(cellQuantidade);
            row.appendChild(cellValorUnitario);
            row.appendChild(cellTotal);
            tabelaBody.appendChild(row);
        }

        for (let i = 0; i < 15; i++) {
            adicionarLinha();
        }

        btnValorTotal.addEventListener('click', () => {
            let totalMateriais = 0;
            const cellsTotal = document.querySelectorAll('.total-cell');
            cellsTotal.forEach(cell => {
                const text = cell.textContent.replace('R$ ', '').replace('.', '').replace(',', '.').trim();
                totalMateriais += parseFloat(text) || 0;
            });

            const diaria = parseFloat(inputDiaria.value) || 0;
            const margemPercent = parseFloat(inputMargem.value) || 0;

            const base = totalMateriais + diaria;
            const valorMargem = base * (margemPercent / 100);
            const final = base + valorMargem;

            resultadoFinal.textContent = `Resultado Final: ${formatarMoeda(final)}`;
        });
    </script>
</body>
</html>